!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).compromiseExport=n()}(this,(function(){"use strict";var t=function(t){var n=Object.keys(t).filter((function(n){return t[n]>=2}));return(n=n.sort((function(n,r){return t[n]>t[r]?-1:t[n]<t[r]?1:0}))).reduce((function(t,n,r){return t[n]=r,t}),{})},n=function(t,n){var r=n.tags,e=[];return t.forEach((function(t){r[t]&&r[t].isA&&(e=e.concat(r[t].isA))})),e=e.reduce((function(t,n){return t[n]=!0,t}),{}),t=t.filter((function(t){return!e[t]}))},r=function(t){var n={};t.forEach((function(t){n[t]=n[t]||0,n[t]+=1}));var r=Object.keys(n);return(r=r.sort((function(t,r){return n[t]>n[r]?-1:1}))).map((function(t){return[t,n[t]]}))},e=function(){var e=this,o=this.json({text:!1,trim:!1,terms:{tags:!0,whitespace:!0}}),u=[],i={};o=o.map((function(t){return t.terms.map((function(t){return i[t.text]=i[t.text]||0,i[t.text]+=1,i[t.pre]=i[t.pre]||0,i[t.pre]+=1,i[t.post]=i[t.post]||0,i[t.post]+=1,t.tags=n(t.tags,e.world),u=u.concat(t.tags),[t.pre,t.text,t.post,t.tags]}))})),u=r(u);var f={};u.forEach((function(t,n){f[t[0]]=n}));var c=t(i);o.forEach((function(t){t.forEach((function(t){t[3]=t[3].map((function(t){return f[t]})).join(","),t[0]=void 0!==c[t[0]]?c[t[0]]:t[0],t[1]=void 0!==c[t[1]]?c[t[1]]:t[1],t[2]=void 0!==c[t[2]]?c[t[2]]:t[2]}))}));var s=[];return Object.keys(c).forEach((function(t){s[c[t]]=t})),{tags:Object.keys(f),words:s,list:o}},o=function(t){return"string"==typeof t&&(t=JSON.parse(t)),t.list.map((function(n){return{terms:n.map((function(n){var r=n[3].split(",").map((function(n){return t.tags[n]}));return{pre:"number"==typeof n[0]?t.words[n[0]]:n[0],text:"number"==typeof n[1]?t.words[n[1]]:n[1],post:"number"==typeof n[2]?t.words[n[2]]:n[2],tags:r.filter((function(t){return t}))}}))}}))};return function(t,n,r){t.prototype.export=e,r.import=function(t){var n=o(t,this.world);return r.fromJSON(n)},r.load=r.import}}));
